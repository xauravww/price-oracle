// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [pgvector(map: "vector")]
}

model PriceEntry {
  id            String   @id @default(uuid())
  item          String
  location      String
  price         Float
  timestamp     DateTime @default(now())
  upvotes       Int      @default(0)
  downvotes     Int      @default(0)
  isTrusted     Boolean  @default(false)
  contributorId String

  @@index([timestamp])
  @@index([item])
  @@map("price_entries")
}

model VecItem {
  id        String                         @id
  embedding Unsupported("vector(1536)")?

  @@map("vec_items")
}

model Log {
  id            Int      @id @default(autoincrement())
  query         String
  priceResult   Float?   @map("price_result")
  deepSearch    Boolean  @default(false) @map("deep_search")
  timestamp     DateTime @default(now())
  status        String?
  responseTime  Int?     @map("response_time")

  @@index([timestamp])
  @@map("logs")
}

model TrustedSource {
  id        Int      @id @default(autoincrement())
  name      String
  url       String   @unique
  category  String
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([category])
  @@map("trusted_sources")
}

model ReportedUrl {
  id        Int      @id @default(autoincrement())
  url       String
  title     String?
  query     String?
  timestamp DateTime @default(now())
  status    String   @default("pending")

  @@index([timestamp])
  @@map("reported_urls")
}

model BlacklistRule {
  id          Int      @id @default(autoincrement())
  pattern     String
  type        String   // 'DOMAIN' or 'REGEX'
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  description String?

  @@map("blacklist_rules")
}
